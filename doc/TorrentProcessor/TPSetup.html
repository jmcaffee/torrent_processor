<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=IBM437" http-equiv="Content-Type">

<title>class TorrentProcessor::TPSetup - TorrentProcessor Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/torrentprocessor/tpsetup.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">KtCmdLine</span>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-askUser">#askUser</a>
    
    <li><a href="#method-i-checkSetupCompleted">#checkSetupCompleted</a>
    
    <li><a href="#method-i-configExists-3F">#configExists?</a>
    
    <li><a href="#method-i-dbExists-3F">#dbExists?</a>
    
    <li><a href="#method-i-printHeader">#printHeader</a>
    
    <li><a href="#method-i-setupApp">#setupApp</a>
    
    <li><a href="#method-i-setupConfig">#setupConfig</a>
    
    <li><a href="#method-i-setupDb">#setupDb</a>
    
    <li><a href="#method-i-verbose-3D">#verbose=</a>
    
    <li><a href="#method-i-verifyUserInputs">#verifyUserInputs</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../docs/README_rdoc.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../TorrentProcessor.html">TorrentProcessor</a>
  
    <li><a href="../TorrentProcessor/Config.html">TorrentProcessor::Config</a>
  
    <li><a href="../TorrentProcessor/Console.html">TorrentProcessor::Console</a>
  
    <li><a href="../TorrentProcessor/Controller.html">TorrentProcessor::Controller</a>
  
    <li><a href="../TorrentProcessor/Database.html">TorrentProcessor::Database</a>
  
    <li><a href="../TorrentProcessor/Formatter.html">TorrentProcessor::Formatter</a>
  
    <li><a href="../TorrentProcessor/Plugin.html">TorrentProcessor::Plugin</a>
  
    <li><a href="../TorrentProcessor/Plugin/CfgPlugin.html">TorrentProcessor::Plugin::CfgPlugin</a>
  
    <li><a href="../TorrentProcessor/Plugin/Command.html">TorrentProcessor::Plugin::Command</a>
  
    <li><a href="../TorrentProcessor/Plugin/DBPlugin.html">TorrentProcessor::Plugin::DBPlugin</a>
  
    <li><a href="../TorrentProcessor/Plugin/DBPluginBase.html">TorrentProcessor::Plugin::DBPluginBase</a>
  
    <li><a href="../TorrentProcessor/Plugin/PluginManager.html">TorrentProcessor::Plugin::PluginManager</a>
  
    <li><a href="../TorrentProcessor/Plugin/Tester.html">TorrentProcessor::Plugin::Tester</a>
  
    <li><a href="../TorrentProcessor/Plugin/UTPlugin.html">TorrentProcessor::Plugin::UTPlugin</a>
  
    <li><a href="../TorrentProcessor/Processor.html">TorrentProcessor::Processor</a>
  
    <li><a href="../TorrentProcessor/TPSetup.html">TorrentProcessor::TPSetup</a>
  
    <li><a href="../TorrentProcessor/TorrentData.html">TorrentProcessor::TorrentData</a>
  
    <li><a href="../TorrentProcessor/UTorrentWebUI.html">TorrentProcessor::UTorrentWebUI</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class TorrentProcessor::TPSetup</h1>

  <div id="description" class="description">
    
<p><a href="TPSetup.html">TPSetup</a> class</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(controller)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p><a href="TPSetup.html">TPSetup</a> constructor</p>
<dl class="rdoc-list note-list"><dt>controller
<dd>
<p>controller object</p>
</dd></dl>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">controller</span>)
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::initialize&quot;</span>
        
        <span class="ruby-ivar">@controller</span> = <span class="ruby-identifier">controller</span>
        <span class="ruby-ivar">@cfg</span> = <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">cfg</span>
        <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-askUser" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">askUser</span><span
            class="method-args">(questions)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get data from the user.</p>
<dl class="rdoc-list note-list"><dt>questions
<dd>
<p>array of questions.</p>
</dd><dt>returns
<dd>
<p>array of user's answers. Index of answer matches index of question.</p>
</dd></dl>
          

          
          <div class="method-source-code" id="askUser-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">askUser</span>(<span class="ruby-identifier">questions</span>)
        <span class="ruby-identifier">printHeader</span>(<span class="ruby-string">&quot;Torrent Processor Setup&quot;</span>)
        
        <span class="ruby-identifier">answers</span> = []
        <span class="ruby-identifier">questions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tq</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">answers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">getInput</span>(<span class="ruby-identifier">tq</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">answers</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- askUser-source -->
          
        </div>

        

        
      </div><!-- askUser-method -->

    
      <div id="method-i-checkSetupCompleted" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkSetupCompleted</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Check if setup has been completed.</p>
<dl class="rdoc-list note-list"><dt>returns
<dd>
<p>false if setup is not yet completed</p>
</dd></dl>
          

          
          <div class="method-source-code" id="checkSetupCompleted-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">checkSetupCompleted</span>()
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::checkSetupCompleted&quot;</span>
        
        <span class="ruby-comment"># Test for an existing config file.</span>
        <span class="ruby-identifier">foundConfig</span> = <span class="ruby-identifier">configExists?</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">foundConfig</span>
        
        <span class="ruby-comment"># Test for an existing DB.</span>
        <span class="ruby-identifier">foundDb</span> = <span class="ruby-identifier">dbExists?</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">foundDb</span>
        
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- checkSetupCompleted-source -->
          
        </div>

        

        
      </div><!-- checkSetupCompleted-method -->

    
      <div id="method-i-configExists-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configExists?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Check if config file exists</p>
<dl class="rdoc-list note-list"><dt>returns
<dd>
<p>false if setup is not yet completed</p>
</dd></dl>
          

          
          <div class="method-source-code" id="configExists-3F-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">configExists?</span>()
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::configExists?()&quot;</span>
        
        <span class="ruby-comment"># Test for an existing config file.</span>
        
        <span class="ruby-identifier">foundConfig</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;torrentprocessor.yml&quot;</span>) )
                <span class="ruby-identifier">foundConfig</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;config.yml&quot;</span>) )
                <span class="ruby-identifier">foundConfig</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">foundConfig</span>
        
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- configExists-3F-source -->
          
        </div>

        

        
      </div><!-- configExists-3F-method -->

    
      <div id="method-i-dbExists-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dbExists?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Check if DB file exists</p>
<dl class="rdoc-list note-list"><dt>returns
<dd>
<p>false if DB doesn't exist</p>
</dd></dl>
          

          
          <div class="method-source-code" id="dbExists-3F-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dbExists?</span>()
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::dbExists?()&quot;</span>
        
        <span class="ruby-comment"># Test for an existing DB.</span>
        
        <span class="ruby-identifier">foundDb</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;tp.db&quot;</span>) )
                <span class="ruby-identifier">foundDb</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">foundDb</span>
        
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dbExists-3F-source -->
          
        </div>

        

        
      </div><!-- dbExists-3F-method -->

    
      <div id="method-i-printHeader" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">printHeader</span><span
            class="method-args">(hdr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Print a header to STDOUT. Header is surrounded with lines.</p>
<dl class="rdoc-list note-list"><dt>hdr
<dd>
<p>header to print</p>
</dd></dl>
          

          
          <div class="method-source-code" id="printHeader-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">printHeader</span>(<span class="ruby-identifier">hdr</span>)
        <span class="ruby-identifier">puts</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">'-'</span>* <span class="ruby-identifier">hdr</span>.<span class="ruby-identifier">size</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-identifier">hdr</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">'-'</span>* <span class="ruby-identifier">hdr</span>.<span class="ruby-identifier">size</span>
        <span class="ruby-identifier">puts</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- printHeader-source -->
          
        </div>

        

        
      </div><!-- printHeader-method -->

    
      <div id="method-i-setupApp" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setupApp</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Setup application</p>
          

          
          <div class="method-source-code" id="setupApp-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setupApp</span>()
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::setupApp&quot;</span>
        <span class="ruby-identifier">setupConfig</span>()
        <span class="ruby-identifier">setupDb</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- setupApp-source -->
          
        </div>

        

        
      </div><!-- setupApp-method -->

    
      <div id="method-i-setupConfig" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setupConfig</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Setup the config file by building a list of questions, display them to the
user and collecting the answers. Once the user has confirmed the submitted
information we can apply the answers to the config file. The answers will
be in the same order as the questions.</p>
          

          
          <div class="method-source-code" id="setupConfig-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setupConfig</span>()
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::setupConfig()&quot;</span>
        <span class="ruby-comment">#return getTokenValues_TEST()</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">configExists?</span>
                <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">getInput</span>(<span class="ruby-string">&quot;A configuration file already exists. Do you wish to recreate it? (Y/n)&quot;</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">choice</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Y'</span>
                
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Deleting configuration file...&quot;</span>
                <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;config.yml&quot;</span>) ) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;config.yml&quot;</span>) )
                <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;torrentprocessor.yml&quot;</span>) ) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;torrentprocessor.yml&quot;</span>) )
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-identifier">questions</span> = []
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;IP of machine running uTorrent (default: 127.0.0.1) :&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;uTorrent webui port:&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;uTorrent webui user name:&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;uTorrent webui user password:&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;Folder to store logs in [full path] (default: #{@cfg[:appPath]}):&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Max size of log file in bytes (default: 0 = no limit):&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Processing folder for TV Shows [full path]:&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Processing folder for Movies [full path]:&quot;</span>
        <span class="ruby-identifier">questions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Processing folder for other downloads [full path] (default: TV Shows folder):&quot;</span>
        
        <span class="ruby-identifier">answers</span> = <span class="ruby-identifier">askUser</span>(<span class="ruby-identifier">questions</span>)
        
        <span class="ruby-comment"># Set defaults here:</span>
        <span class="ruby-comment"># All questions are required (except #1, 5, and 6)</span>
        
        <span class="ruby-comment"># WebUI port</span>
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">answers</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">empty?</span>)
                <span class="ruby-identifier">answers</span>[<span class="ruby-value">0</span>] = <span class="ruby-string">&quot;127.0.0.1&quot;</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># Log dir</span>
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">answers</span>[<span class="ruby-value">4</span>].<span class="ruby-identifier">empty?</span>)
                <span class="ruby-identifier">answers</span>[<span class="ruby-value">4</span>] = <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>]
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># Max size of log file</span>
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">answers</span>[<span class="ruby-value">5</span>].<span class="ruby-identifier">empty?</span>)
                <span class="ruby-identifier">answers</span>[<span class="ruby-value">5</span>] = <span class="ruby-value">0</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">answers</span>[<span class="ruby-value">5</span>] = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">answers</span>[<span class="ruby-value">5</span>])
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># Processing folder (other)</span>
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">answers</span>[<span class="ruby-value">8</span>].<span class="ruby-identifier">empty?</span>)
                <span class="ruby-identifier">answers</span>[<span class="ruby-value">8</span>] = <span class="ruby-identifier">answers</span>[<span class="ruby-value">6</span>]
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">while</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">verifyUserInputs</span>(<span class="ruby-identifier">questions</span>, <span class="ruby-identifier">answers</span>))
                <span class="ruby-identifier">answers</span> = <span class="ruby-identifier">askUser</span>(<span class="ruby-identifier">questions</span>)
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:ip</span>]                                                            = <span class="ruby-identifier">answers</span>[<span class="ruby-value">0</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:port</span>]                                                  = <span class="ruby-identifier">answers</span>[<span class="ruby-value">1</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:user</span>]                                                  = <span class="ruby-identifier">answers</span>[<span class="ruby-value">2</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:pass</span>]                                                  = <span class="ruby-identifier">answers</span>[<span class="ruby-value">3</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:logdir</span>]                                                = <span class="ruby-identifier">answers</span>[<span class="ruby-value">4</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:maxlogsize</span>]                            = <span class="ruby-identifier">answers</span>[<span class="ruby-value">5</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:tvprocessing</span>]                  = <span class="ruby-identifier">answers</span>[<span class="ruby-value">6</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:movieprocessing</span>]       = <span class="ruby-identifier">answers</span>[<span class="ruby-value">7</span>]
        <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:otherprocessing</span>]       = <span class="ruby-identifier">answers</span>[<span class="ruby-value">8</span>]
        
        <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>( <span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>] )
        <span class="ruby-identifier">c</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">c</span>.<span class="ruby-identifier">cfg</span> = <span class="ruby-ivar">@cfg</span>
        <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- setupConfig-source -->
          
        </div>

        

        
      </div><!-- setupConfig-method -->

    
      <div id="method-i-setupDb" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setupDb</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Setup the DB file by creating the DB and tables.</p>
          

          
          <div class="method-source-code" id="setupDb-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 249</span>
                <span class="ruby-keyword">def</span> <span class="ruby-identifier">setupDb</span>()
                        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;TPSetup::setupDb()&quot;</span>
                        
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">dbExists?</span>
                                <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">getInput</span>(<span class="ruby-string">&quot;A database already exists. Do you wish to recreate it? (Y/n)&quot;</span>)
                                <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">choice</span> <span class="ruby-operator">!=</span> <span class="ruby-string">'Y'</span>
                                
                                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Deleting database...&quot;</span>
                                <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;tp.db&quot;</span>) )
                        <span class="ruby-keyword">end</span>
                        
                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Creating database...&quot;</span>
                        <span class="ruby-identifier">database</span> = <span class="ruby-constant">SQLite3</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">new</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@cfg</span>[<span class="ruby-value">:appPath</span>], <span class="ruby-string">&quot;tp.db&quot;</span>) )
                        
                        <span class="ruby-identifier">schema</span> = <span class="ruby-string">&quot;-- Create the torrents table
CREATE TABLE torrents (
        id INTEGER PRIMARY KEY, 
        hash TEXT UNIQUE, 
        created DATE, 
        modified DATE, 
        status NUMERIC,
        name TEXT, 
        percent_progress NUMERIC,
        ratio NUMERIC,
        label TEXT,
        msg TEXT,
        folder TEXT,
        tp_state TEXT DEFAULT NULL
);
--  Create an update trigger
CREATE TRIGGER update_torrents AFTER UPDATE  ON torrents
BEGIN

UPDATE torrents SET modified = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
END;
--
--  Also create an insert trigger
--    NOTE  AFTER keyword ------v
CREATE TRIGGER insert_torrents AFTER INSERT ON torrents
BEGIN

UPDATE torrents SET created = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
UPDATE torrents SET modified = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
END;
--
--
--
-- Create the torrents_info table
CREATE TABLE torrents_info (
        id INTEGER PRIMARY KEY, 
        cache_id TEXT, 
        created DATE, 
        modified DATE
);
--  Create an update trigger
CREATE TRIGGER update_torrents_info AFTER UPDATE  ON torrents_info
BEGIN

UPDATE torrents_info SET modified = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
END;
--
--  Also create an insert trigger
--    NOTE  AFTER keyword ------------v
CREATE TRIGGER insert_torrents_info AFTER INSERT ON torrents_info
BEGIN

UPDATE torrents_info SET created = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
UPDATE torrents_info SET modified = DATETIME('NOW')
         WHERE rowid = NEW.rowid;
                                 
END;
--
-- Insert a cache record as part of initialization
INSERT INTO torrents_info (cache_id) values (NULL);
--
--
--
-- Create the app_lock table
CREATE TABLE app_lock (
        id INTEGER PRIMARY KEY, 
        locked TEXT
);
--
-- Insert a lock record as part of initialization
INSERT INTO app_lock (locked) values (&quot;N&quot;);
&quot;</span>
                        <span class="ruby-identifier">database</span>.<span class="ruby-identifier">execute_batch</span>( <span class="ruby-identifier">schema</span> )
                <span class="ruby-keyword">end</span></pre>
          </div><!-- setupDb-source -->
          
        </div>

        

        
      </div><!-- setupDb-method -->

    
      <div id="method-i-verbose-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">verbose=</span><span
            class="method-args">(arg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Set the verbose flag</p>
<dl class="rdoc-list note-list"><dt>arg
<dd>
<p>verbose mode if true</p>
</dd></dl>
          

          
          <div class="method-source-code" id="verbose-3D-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verbose=</span>(<span class="ruby-identifier">arg</span>)
        <span class="ruby-identifier">$LOG</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;TPSetup::verbose=( #{arg} )&quot;</span>
        <span class="ruby-ivar">@verbose</span> = <span class="ruby-identifier">arg</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- verbose-3D-source -->
          
        </div>

        

        
      </div><!-- verbose-3D-method -->

    
      <div id="method-i-verifyUserInputs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">verifyUserInputs</span><span
            class="method-args">(questions, answers)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>verifyUserInputs should be called after getting user input.Asks the user if
they are happy with the values they supplied and gives them an opportunity
to change their answer or quit the program.</p>
          

          
          <div class="method-source-code" id="verifyUserInputs-source">
            <pre><span class="ruby-comment"># File lib/torrentprocessor/tpsetup.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verifyUserInputs</span>(<span class="ruby-identifier">questions</span>, <span class="ruby-identifier">answers</span>)
        <span class="ruby-identifier">printHeader</span>(<span class="ruby-string">&quot;Verify Torrent Processor Settings:&quot;</span>)
        
        <span class="ruby-identifier">questions</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{questions[i]} &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{answers[i]}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">puts</span>
        <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">getInput</span>(<span class="ruby-string">&quot;Is this information correct? (Y/n/q)&quot;</span>)
        <span class="ruby-identifier">exit</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">choice</span> <span class="ruby-operator">==</span> <span class="ruby-string">'q'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">choice</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Y'</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- verifyUserInputs-source -->
          
        </div>

        

        
      </div><!-- verifyUserInputs-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

